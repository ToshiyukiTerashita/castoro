#
# peer.conf - Castoro Peer System Configuration file
#

################################################################################
# Comments
#
# A line beginning with a pound mark # is dealt as a comment line.
; A line beginning with a semi-colon ; is dealt as a comment line, too.

# Parameters that are commented out with a semi-colon in this example file are
# optional while parameters that are not commented out in this example file
# are mandatory.

################################################################################
# File Structure
#
# This configuration file is made up of one global section and one or more 
# service section(s).

################################################################################
[global]

################################################################################
# Hostname
#
# HostnameForClient defines a hostname of this machine to which clients will
# access. This hostname will be sent to Gateway, and then the Gateway will
# send it to client hosts.
#
# The default hostname is determined in the following fashion:
#  ruby -e 'require "socket"; puts Socket::gethostname.split(".")[0]'
#
# If the hostname shown above is suitable, you may leave this item commented out.
#
; HostnameForClient server100

################################################################################
# NIC's IP Address for Multicast and Multicast Address
#
# MulticastAddress specifies a multicast address to which Peer will send
# multicast UDP packets towards Gateways and to which Gateways will also send
# them towards Peers.
#
MulticastAddress 239.192.1.1

# Peer (cpeerd, crepd, and cmond) emits multicast UDP packets towards Castoro
# Gateways and Gateway also does ones towards Peers (cpeerd). A Network
# Interface Card (NIC)'s IP address on this host through which multicast
# packets are sent and received is defined here.
#
# The default NIC's IP address is determined by
#  ruby -e 'require "socket"; puts IPSocket::getaddress(Socket::gethostname)'
#
# If the address shown above is suitable, you may leave the following two items
# commented out. Otherwise, you need to specify it by assigning either of them.
#
# MulticastNetwork specifies a network address to which the NIC is connected.
# An IP address of the NIC will be automatically determined.
#
; MulticastNetwork 192.168.1.0/255.255.255.0
; MulticastNetwork 192.168.1.0/24

# MulticastIf explicitly specifies an IP address of the NIC.
#
; MulticastIf 192.168.1.100

################################################################################
# Port Numbers
#
# GatewayUDPCommandPort specifies a UDP port number of Gateway to which Peer
# (cpeerd and crepd) sends requests via multicast.
GatewayUDPCommandPort            30109

# PeerTCPCommandPort specifies a TCP port number to which Peer (cpeerd) listens.
# This port is for requests from client hosts via TCP connection.
PeerTCPCommandPort               30111

# PeerUDPCommandPort specifies a UDP port number to which Peer (cpeerd) binds.
# This port is for requests from Gateways via UDP multicast.
PeerUDPCommandPort               30112

# WatchDogUDPCommandPort specifies a UDP port number of Gateways to which Peer
# (cmond) sends watch-dog packets for Gateways via multicast.
WatchDogUDPCommandPort           30113

# ReplicationTCPCommunicationPort specifies a TCP port number of neighboring 
# Peers to which Peer (crepd) sends replication data and to which Peer (crepd)
# listens to receive replication data from neighboring Peers.
ReplicationTCPCommunicationPort  30148

# ReplicationUDPCommandPort specifies a UDP port number to which Peer (crepd)
# binds. This port is used for internal communication on the Peer. Soon after
# cpeerd has processed a FINALIZE command, it sends a command packet to crepd
# to notify a new basket has been created.
ReplicationUDPCommandPort        30149

# CmondMaintenancePort, CpeerdMaintenancePort, and CrepdMaintenancePort 
# specify TCP port numbers to which deamon processes of Peer (cmond, cpeerd, 
# and crepd, respectively) listen. They receive remote maintenance commands 
# from peerctl command via the ports. Additionally, cpeerd and crepd receive
# internal maintainance commands from cmond through this port.
CmondMaintenancePort             30100
CpeerdMaintenancePort            30102
CrepdMaintenancePort             30103

# CmondHealthCheckPort, CpeerdHealthCheckPort, and CrepdHealthCheckPort 
# specify TCP port numbers to which deamon processes of Peer (cmond, cpeerd, 
# and crepd, respectively) listen. Cmond on this host establishes a connection
# to other cmond running on neighboring Peers to monitor the status of the
# neighbors, vice versa. Additionally, cmond establishes an internal connection
# to both cpeerd and crepd running on this host to monitor their status.
CmondHealthCheckPort             30105
CpeerdHealthCheckPort            30107
CrepdHealthCheckPort             30108

################################################################################
# The number of workers for cpeerd
#
# These parameters specify the number of internal workers in the Peer (cpeerd)
NumberOfUDPCommandProcessor      10
NumberOfTCPCommandProcessor      10
NumberOfBasketStatusQueryDB      10
NumberOfCsmController             3
NumberOfUdpResponseSender        10
NumberOfTcpResponseSender        10
NumberOfMulticastCommandSender    3
NumberOfReplicationDBClient       1

################################################################################
# Frequency
#
# PeriodOfAlivePacketSender specifies how often Peer (cmond) emits watch-dog 
# packets towards Gateways. The unit is in seconds.
PeriodOfAlivePacketSender         4

# PeriodOfStatisticsLogger specifies how often internal statistics figures
# are collected in Peer (cpeerd). The unit is in seconds.
PeriodOfStatisticsLogger         60

################################################################################
# Peer Group Configuration
#
# StorageGroupsFile specifies a file name in which peer groups are defined.
# Hostnames in the file are a logical hostname appearing in the log file.
StorageGroupsFile         /etc/castoro/storage_groups.json

# StorageHostsFile specifies a file name in which logical hostnames and their
# corresponding physical hostnames are defined. A physical hostname is the
# hostname to which Peer (crepd) establishs a connection and replicates baskets.
StorageHostsFile          /etc/castoro/storage_hosts.yml

################################################################################
# Effective User ID
#
# EffectiveUser specifies an effective user id. Deamon processes of Peer 
# (cmond, cpeerd, and cmond) runs as this user id. 
# If they are invoked as a root user, they will change their effective user 
# id from root to this effective user id. If those daemon processes are invoked
# as a normal user, they will not change their user id.
EffectiveUser             castoro

################################################################################
# Replication
#
# ReplicationTransmissionDataUnitSize specifies the size of transmission data
# being sent at a time. If the size of file being sent is greater than this
# size, several continuous transmissions will be carried out to transfer all
# data in the file. The unit is in bytes.
ReplicationTransmissionDataUnitSize     1048576

# NumberOfReplicationSender specifies the number of internal workers in the
# Peer (crepd).
NumberOfReplicationSender         3

################################################################################
# Castoro Manipulator
#
# UseManipulatorDaemon specifies whether Castoro Manipulator daemon is used.
UseManipulatorDaemon      yes

# ManipulatorSocket specifies a UNIX socket file. The socket file is created
# by the Castoro Manipulator daemon process. Both cpeerd and crepd use this
# socket file to communicate with Castoro Manipulator daemon.
ManipulatorSocket         /var/castoro/manipulator.sock

################################################################################
# Storage
#
# BasketBaseDir specifies a base directory of storage area
BasketBaseDir /expdsk

# The following parameters specify user id, group id, and permission bits for 
# working directory.
# "BasketBaseDir/type/baskets/w/..."
Dir_w_user   castoro
Dir_w_group  castoro
Dir_w_perm   0777

# The following parameters specify user id, group id, and permission bits for 
# archive directory.
# "BasketBaseDir/type/baskets/a/..."
Dir_a_user   root
Dir_a_group  castoro
Dir_a_perm   0555

# The following parameters specify user id, group id, and permission bits for
# the directory where deleted files are stored.
# "BasketBaseDir/type/offline/deleted/..."
Dir_d_user   root
Dir_d_group  castoro
Dir_d_perm   0555

# The following parameters specify user id, group id, and permission bits for
# the directory where canceled files are stored.
# "BasketBaseDir/type/offline/canceled/..."
Dir_c_user   root
Dir_c_group  castoro
Dir_c_perm   0555

################################################################################
[service]

# ServiceName specifies a service name. This name distinguishes services.
# Any arbitrary name is acceptable.
ServiceName service1

# TypeIdRanges specifies a value or range of type-id that this service uses.
# By delimiting with a comma, you may specify several values and ranges.
# Examples:
#   0,1,2
#   0-999
#   0-999, 2000, 3000-3999
TypeIdRanges 0-999

# BasketKeyConverterModuleName specifies a name of Basket Key Converter Module
# There are two modules available:
#   Dec40Seq - decimal number, 40bit content-id, sequencial-content-id-tuned
#   Hex64Seq - hexdecimal number, 64bit content-id, sequencial-content-id-tuned
BasketKeyConverterModuleName Dec40Seq

################################################################################
[service]

# ServiceName specifies a service name. This name distinguishes services.
# Any arbitrary name is acceptable.
ServiceName service2

# TypeIdRanges specifies a value or range of type-id that this service uses.
# By delimiting with a comma, you may specify several values and ranges.
# Examples:
#   0,1,2
#   0-999
#   0-999, 2000, 3000-3999
TypeIdRanges 1000-1999

# BasketKeyConverterModuleName specifies a name of Basket Key Converter Module
# There are two modules available:
#   Dec40Seq - decimal number, 40bit content-id, sequencial-content-id-tuned
#   Hex64Seq - hexdecimal number, 64bit content-id, sequencial-content-id-tuned
BasketKeyConverterModuleName Hex64Seq

################################################################################
