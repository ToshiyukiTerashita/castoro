#
# peer.conf - Castoro Peer システム設定ファイル
#

################################################################################
# シャープ # で始まる行は、コメント行として扱われます。
; セミコロン ; で始まる行も、コメント行として扱われます。

################################################################################
# ホスト名
#
# HostnameForClient で、このマシンのホスト名を定義します。クライアントはこの
# ホスト名に対してアクセスします。このホスト名はゲートウェイへ送られ、そして、
# ゲートウェイはこのホスト名をクライアントホストへ送ります。
#
# デフォルトのホスト名は、次の方法で決定されます。
#  ruby -e 'require "socket"; puts Socket::gethostname.split(".")[0]'
#
# 上記のホスト名でよろしければ、この項目をコメントアウトしたままで構いません。
this item
#
; HostnameForClient server100

################################################################################
# マルチキャスト用 NIC の IP アドレス と マルチキャストアドレス
#
# MulticastAddress で、マルチキャストアドレスを指定します。ピアはゲートウェイに
# 向けて、マルチキャスト UDP パケットをそのマルチキャストアドレスへ送信します。
# そして、ゲートウェイもまた、ピアに向けて送信します。
# also
# no will is needed
#
MulticastAddress 239.192.1.1

# ピア (cpeerd、 crepd と cmond) はマルチキャスト UDP パケットを Castoro 
# ゲートウェイに向けて送出し、ゲートウェイもまたピア (cpeerd) に向けて送出します。
# このホスト上のネットワークインターフェースカード (NIC) の IP アドレスをここで
# 定義します。マルチキャストパケットは、その NIC 経由で送受信されます。
#
# デフォルトの NIC の IP アドレスは、以下の方法で決まります。
#  ruby -e 'require "socket"; puts IPSocket::getaddress(Socket::gethostname)'
#
# もし、上述のアドレスが適切であるなら、以下の項目をそのままコメントアウトして
# the following two items
# おいて構いません。そうでなければ、どちらか一つを割り当てて、アドレスを指定して
# ください。
# either
#
# MulticastNetwork で、NIC が接続されているネットワークアドレスを指定します。
# MulticastNetwork specifies a network address to which the NIC is connected.
# その NIC の IP アドレスは、自動的に求められます。
#
; MulticastNetwork 192.168.1.0/255.255.255.0
; MulticastNetwork 192.168.1.0/24

# MulticastIf で、NIC の IP アドレスを明示的に指定します。
# MulticastIf explicitly specifies an IP address of the NIC.
#
; MulticastIf 192.168.1.100

################################################################################
# ポート番号
#
# GatewayUDPCommandPort で、ゲートウェイのポート番号を指定します。ピア (cpeerd
# UDP port number
# と crepd) は、そのポート番号へ要求をマルチキャスト経由で送ります。
GatewayUDPCommandPort            30109

# PeerTCPCommandPort で、ピア (cpeerd) が待ち受ける TCP ポート番号を指定します。
# このポートは、TCP 接続経由でのクライアントホストからの要求用です。
# this port is for requests...
PeerTCPCommandPort               30111

# PeerUDPCommandPort で、ピア (cpeerd) が結びつける UDP ポート番号を指定します。
# このポートは、UDP 接続経由でのゲートウェイからの要求用です。
PeerUDPCommandPort               30112

# WatchDogUDPCommandPort で、ゲートウェイのUDP ポート番号を指定します。ピア 
# (cmond) はワッチドッグ・パケットをマルチキャストでそのポート番号へ送ります。
port number of Gateways
WatchDogUDPCommandPort           30113

# ReplicationTCPCommunicationPort で、近隣のピア (crepd) のTCP ポート番号を
# 指定します。ピア (crepd) は、レプリケーション・データをそのポート番号へ
# 送ります。また、ピア (crepd) は、近隣のピアからレプリケーション・データを
# 受信するために、そのポート番号で待ち受けます。
# TCP port number of neighboring Peers
ReplicationTCPCommunicationPort  30148

# ReplicationUDPCommandPort で、UDP ポート番号を指定します。ピア (crepd) は
# そのポート番号へ結びつけます。このポートは、ピア上での内部通信に使われます。
# This port is used for internal communication on the Peer. 
# cpeerd は FINALIZE コマンドを処理するとすぐに、新しいバスケットが
# 作成されたことを通知するために、コマンドパケットを crepd へ送ります。
# cpeerd sends a command packet to crepd to
# notify that a new basket has been created 
# soon after cpeerd processes a FINALIZE command,
ReplicationUDPCommandPort        30149

# CmondMaintenancePort、CpeerdMaintenancePort、及び CrepdMaintenancePort で、
# ピアの各デーモンプロセス (cmond、cpeerd、及び crepd) がそれぞれ待ち受ける
# TCP ポート番号を指定します。
# 各デーモンプロセスはこれらのポート経由で peerctl コマンドからの遠隔保守
# コマンドを受け取ります。
# 加えて、cpeerd と crepd は、それらのポート経由で cmond からの内部保守コマンドを
# 受け取ります。
# CmondMaintenancePort, CpeerdMaintenancePort, and CrepdMaintenancePort 
# specify TCP port numbers to which deamon processes of Peer (cmond, cpeerd, 
# and crepd, respectively) listen. They receive remote maintenance commands 
# from peerctl command via the ports.
# Additionally, cpeerd and crepd receive internal maintainance commands from 
# cmond through this port.

CmondMaintenancePort             30100
CpeerdMaintenancePort            30102
CrepdMaintenancePort             30103

# CmondHealthCheckPort、CpeerdHealthCheckPort、 及び、CrepdHealthCheckPort で、
# ピアの各デーモンプロセス (cmond、cpeerd、及び crepd) がそれぞれ待ち受ける
# TCP ポート番号を指定します。
# このホスト上の cmond は、近隣の状態を監視するために、近隣のピア上で動作して
# いる別の cmond へ接続を確立します。また、その逆方向もです。
# 加えて、cmond は、このホスト上で動作している cpeerd と crepd の両方の状態を
# 監視するために、それらへ接続を確立します。

# CmondHealthCheckPort, CpeerdHealthCheckPort, and CrepdHealthCheckPort 
# specify TCP port numbers to which deamon processes of Peer (cmond, cpeerd, 
# and crepd, respectively) listen. 
# Cmond on this host establishes a connection to other cmond running on
# neighboring Peers to monitor the status of the neighbors, vice versa.
# Additionally, cmond establishes an internal connection to both cpeerd and 
# crepd running on this host to monitor their status.

CmondHealthCheckPort             30105
CpeerdHealthCheckPort            30107.
CrepdHealthCheckPort             30108

################################################################################
# cpeerd のワーカー数
#
# これらのパラメーターで、ピア (cpeerd) の内部ワーカー数を指定します。
# These parameters specify the number of internal workers in the Peer (cpeerd)
NumberOfUDPCommandProcessor      10
NumberOfTCPCommandProcessor      10
NumberOfBasketStatusQueryDB      10
NumberOfCsmController             3
NumberOfUdpResponseSender        10
NumberOfTcpResponseSender        10
NumberOfMulticastCommandSender    3
NumberOfReplicationDBClient       1

################################################################################
# 頻度
#
# PeriodOfAlivePacketSender で、ピア (cmond) がワッチドック・パケットをどの程度
# の頻度で送出するかを指定します。単位は秒です。

# PeriodOfAlivePacketSender specifies how often Peer (cmond) emits watch-dog 
# packets towards Gateways. The unit is in seconds.
PeriodOfAlivePacketSender         4

# PeriodOfStatisticsLogger で、どの程度の頻度でピア (cpeerd) で内部統計数値が
# 収集されるかを指定します。単位は秒です。

# PeriodOfStatisticsLogger specifies how often internal statistics figures
# are collected in Peer (cpeerd). The unit is in seconds.
PeriodOfStatisticsLogger         60

################################################################################
# ピアグループ構成
#
# StorageGroupsFile で、ピアグループが定義されているファイル名を指定します。
# そのファイル内のホスト名は、ログファイルに現れる論理ホスト名です。

# StorageGroupsFile specifies a file name in which peer groups are defined.
# Hostnames in the file are a logical hostname appearing in the log file.
StorageGroupsFile         /etc/castoro/storage_groups.json

# StorageHostsFile で、論理ホスト名とそれに対応する物理ホスト名が定義されている
# ファイル名を指定します。
# そのファイル内の物理ホスト名が、ピア (crepd) が接続を確立しバスケットを
# レプリケーションする先のホスト名です。

# StorageHostsFile specifies a file name in which logical hostnames and their
# corresponding physical hostnames are defined. A physical hostname is the
# hostname to which Peer (crepd) establishs a connection and replicates baskets.
StorageHostsFile          /etc/castoro/storage_hosts.yml

################################################################################
# 実効ユーザーID
#
# EffectiveUser で、実効ユーザーIDを指定します。
# ピアのデーモンプロセス (cmond、cpeerd、及び crepd) は、このユーザーIDで動作します。
# これらのデーモンプロセスが root ユーザーとして起動されると、それらの実効
ユーザーID を root からこの実効ユーザーID へ変更します。
これらのデーモンプロセスが一般ユーザーとして起動された場合、ユーザーID を変更しません。

# EffectiveUser specifies an effective user id. Deamon processes of Peer 
# (cmond, cpeerd, and cmond) runs as this user id. 
# If they are invoked as a root user, they will change their effective user 
id from root to this effective user id. If those daemon
# processes are invoked as a normal user, they will not change their user id.
EffectiveUser             castoro

################################################################################
# レプリケーション
#
# ReplicationTransmissionDataUnitSize で、一度に送られる転送データサイズを指定
# します。ファイルのサイズがこのサイズよりも大きい場合、ファイルのすべてのデータを
転送するために、複数の連続した転送が行われます。
単位はバイトです。

# ReplicationTransmissionDataUnitSize specifies the size of transmission data
# being sent at a time. If the size of file is greater than this size, several
# continuous transmissions will be done to transfer all data of the file.
# The unit is in bytes.
ReplicationTransmissionDataUnitSize     1048576

# NumberOfReplicationSender で、ピア (crepd) の内部ワーカー数を指定します。
# NumberOfReplicationSender specifies the number of internal workers in the
# Peer (crepd).
NumberOfReplicationSender         3

################################################################################
# Castoro マニピュレーター
#
# UseManipulatorDaemon で、Castoro マニピュレーターを使うかどうか指定します。
# UseManipulatorDaemon specifies whether Castoro Manipulator daemon is used.
UseManipulatorDaemon      yes

# ManipulatorSocket で、UNIX ソケットファイルを指定します。
# そのソケットファイルは、Castoro マニピュレーターによって作成されます。
# 
specifies a UNIX socket file. The socket file is created
# by the Castoro Manipulator daemon process.
cpeerd と crepd の両方は、このソケットファイルを使って、Castoro マニピュレーター・
デーモンと会話します。

# file to communicate with Castoro Manipulator daemon.
# ManipulatorSocket specifies a UNIX socket file. The socket file is created
# by the Castoro Manipulator daemon process. Both cpeerd and crepd use this socket
# file to communicate with Castoro Manipulator daemon.
ManipulatorSocket         /var/castoro/manipulator.sock

################################################################################
# ストレージ
#
# BasketBaseDir で、ストレージ領域の基本ディレクトリを指定します。
# BasketBaseDir specifies a base directory of storage area
BasketBaseDir /expdsk

# 次のパラメーターで、作業ディレクトリのユーザーID、グループID、及び、
# パーミッション・ビットを指定します。
# "BasketBaseDir/type/baskets/w/..."

# The following parameters specify user id, group id, and permission bits for 
# working directory.
# "BasketBaseDir/type/baskets/w/..."
Dir_w_user   castoro
Dir_w_group  castoro
Dir_w_perm   0777

# 次のパラメーターで、保管ディレクトリのユーザーID、グループID、及び、
# パーミッション・ビットを指定します。
# "BasketBaseDir/type/baskets/a/..."

# The following parameters specify user id, group id, and permission bits for 
# archive directory.
# "BasketBaseDir/type/baskets/a/..."
Dir_a_user   root
Dir_a_group  castoro
Dir_a_perm   0555

# 次のパラメーターで、削除されたファイルが保管されるディレクトリのユーザーID、
# グループID、及び、パーミッション・ビットを指定します。
# "BasketBaseDir/type/offline/deleted/..."

# The following parameters specify user id, group id, and permission bits for
# the directory where deleted files are stored.
# "BasketBaseDir/type/offline/deleted/..."
Dir_d_user   root
Dir_d_group  castoro
Dir_d_perm   0555

# 次のパラメーターで、キャンセルされたファイルが保管されるディレクトリの
# ユーザーID、グループID、及び、パーミッション・ビットを指定します。
# "BasketBaseDir/type/offline/canceled/..."
# The following parameters specify user id, group id, and permission bits for
# the directory where canceled files are stored.
# "BasketBaseDir/type/offline/canceled/..."
Dir_c_user   root
Dir_c_group  castoro
Dir_c_perm   0555

################################################################################
[service1]

# ServiceName で、サービス名を指定します。この名前でサービスを区別します。
# 任意な名前が使えます。

# ServiceName specifies a service name. This name distingishs
# services. Any arbitrary name is acceptable.
ServiceName  service1

# TypeIdRanges で、このサービスが使う、タイプIDの値、または、タイプIDの範囲を
# 指定します。カンマで区切って、複数の値と範囲を指定できます。
# 例

# TypeIdRanges specifies a value or range of type-id that this service uses.
# By delimiting with a comma, you may specify several values and ranges.
# Examples:
#   0,1,2
#   0-999
#   0-999, 2000, 3000-3999
TypeIdRanges 0-999

# BasketKeyConverterModuleName で、バスケットキー変換モジュールの名前を指定します。
# 二つのモジュールが使用できます。
#   Dec40Seq - 10進数、40ビット・コンテンツID、連続したコンテンツID対応
#   Hex64Seq - 16進数、64ビット・コンテンツID、連続したコンテンツID対応

# BasketKeyConverterModuleName specifies a name of Basket Key Converter Module
# There are two modules available:
#   Dec40Seq - decimal number, 40bit content-id, sequencial-content-id-tuned
#   Hex64Seq - hexdecimal number, 64bit content-id, sequencial-content-id-tuned
BasketKeyConverterModuleName Dec40Seq

################################################################################
[service2]

# ServiceName で、サービス名を指定します。この名前でサービスを区別します。
# 任意な名前が使えます。

ServiceName  service2

# TypeIdRanges で、このサービスが使う、タイプIDの値、または、タイプIDの範囲を
# 指定します。カンマで区切って、複数の値と範囲を指定できます。
# 例

#   0,1,2
#   0-999
#   0-999, 2000, 3000-3999
TypeIdRanges 1000-1999

# BasketKeyConverterModuleName で、バスケットキー変換モジュールの名前を指定します。
# 二つのモジュールが使用できます。
#   Dec40Seq - 10進数、40ビット・コンテンツID、連続したコンテンツID対応
#   Hex64Seq - 16進数、64ビット・コンテンツID、連続したコンテンツID対応
BasketKeyConverterModuleName  Hex64Seq

################################################################################
